<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>MoneyManager · 快速记账</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/app.css') }}" />
  </head>
  <body>
    <header class="top-nav app-shell">
      <div class="top-nav-inner">
        <a class="brand" href="/">
          <span class="brand-dot"></span>
          <span>MoneyManager</span>
        </a>
        <nav class="nav-links">
          <a class="nav-link {{ 'active' if active_page == 'index' else '' }}" href="/">首页</a>
          <a class="nav-link {{ 'active' if active_page == 'add' else '' }}" href="/add">记账</a>
          <a class="nav-link {{ 'active' if active_page == 'analysis' else '' }}" href="/analysis">分析</a>
          <a class="nav-link {{ 'active' if active_page == 'budget' else '' }}" href="/budget">预算</a>
          <a class="nav-link {{ 'active' if active_page == 'subscriptions' else '' }}" href="/subscriptions">订阅</a>
          <a class="nav-link {{ 'active' if active_page == 'ai' else '' }}" href="/ai">AI 复盘</a>
        </nav>
        <div class="nav-actions">
          <form method="get" action="/" class="toolbar">
            <input type="month" name="month" value="{{ month }}" />
            <button class="btn-secondary" type="submit">切换月份</button>
          </form>
          <a class="btn" href="/add">去记账</a>
        </div>
      </div>
    </header>

    <main class="app-shell">
      <div class="page">
        <section class="panel">
          <h1 class="page-title">快速记账</h1>
          <div class="page-subtitle">目标：5-10 秒完成一笔记录</div>
        </section>

      <section class="panel">
        {% if success == '1' %}
        <div class="msg ok">记账成功，表单已重置。</div>
        {% elif success == '0' %}
        <div class="msg danger">提交失败：请至少填写金额和主类别。</div>
        {% endif %}

        <form id="add-transaction" method="post" action="/add" class="grid-2">
          <div>
            <label class="small" for="amount">金额</label>
            <input id="amount" type="number" step="0.01" min="0.01" name="amount" placeholder="金额" required />
          </div>

          <div>
            <label class="small" for="type">类型</label>
            <select id="type" name="type">
              <option value="expense" selected>支出</option>
              <option value="income">收入</option>
            </select>
          </div>

          <div>
            <label class="small" for="date">日期</label>
            <input id="date" type="date" name="date" value="{{ today }}" />
          </div>

          <div>
            <label class="small" for="category_main">主类别</label>
            <select id="category_main" name="category_main" required>
              <option value="">请选择主类别</option>
              {% for category in category_options %}
              <option value="{{ category }}">{{ category }}</option>
              {% endfor %}
            </select>
          </div>

          <div>
            <label class="small" for="category_sub">子类别</label>
            <input id="category_sub" type="text" name="category_sub" placeholder="如：外卖 / 奶茶 / 书籍" />
          </div>

          <div>
            <label class="small" for="payment_method">支付方式</label>
            <select id="payment_method" name="payment_method">
              <option value="wechat">微信</option>
              <option value="alipay_family">支付宝亲密付</option>
              <option value="bank">银行卡</option>
            </select>
          </div>

          <div style="grid-column: 1 / -1;">
            <label class="small" for="tags">标签（可多选）</label>
            <select id="tags" name="tags" multiple>
              {% for tag in tag_options %}
              <option value="{{ tag }}">{{ tag }}</option>
              {% endfor %}
            </select>
            <div class="small" style="margin-top: 4px;">按住 Ctrl（Windows）可多选</div>
          </div>

          <div style="grid-column: 1 / -1;">
            <label class="small" for="note">备注（可选）</label>
            <input id="note" type="text" name="note" placeholder="备注（可选）" />
          </div>

          <div style="grid-column: 1 / -1;">
            <button class="btn" type="submit">记一笔</button>
          </div>
        </form>
      </section>

      <section class="panel">
        <h2 class="page-title" style="font-size: 18px;">最近记录（10 笔）</h2>
        <div class="table-wrap">
        <table>
          <thead>
            <tr>
              <th>日期</th>
              <th>类型</th>
              <th>金额</th>
              <th>类别</th>
              <th>标签</th>
              <th>支付方式</th>
              <th>备注</th>
            </tr>
          </thead>
          <tbody>
            {% if recent_records %}
              {% for row in recent_records %}
              <tr>
                <td>{{ row.date }}</td>
                <td>{{ '支出' if row.type == 'expense' else '收入' }}</td>
                <td class="{{ row.type }}">¥{{ '%.2f'|format(row.amount) }}</td>
                <td>{{ row.category_main }}{% if row.category_sub %} / {{ row.category_sub }}{% endif %}</td>
                <td>{{ row.tags | join('、') if row.tags else '-' }}</td>
                <td>
                  {% if row.payment_method == 'wechat' %}
                    微信
                  {% elif row.payment_method == 'alipay_family' %}
                    支付宝亲密付
                  {% elif row.payment_method == 'bank' %}
                    银行卡
                  {% else %}
                    -
                  {% endif %}
                </td>
                <td>{{ row.note if row.note else '-' }}</td>
              </tr>
              {% endfor %}
            {% else %}
            <tr>
              <td colspan="7">暂无记录，先记第一笔吧。</td>
            </tr>
            {% endif %}
          </tbody>
        </table>
        </div>
      </section>
      </div>
    </main>
  </body>
</html>
