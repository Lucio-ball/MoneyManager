<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>预算设置 - 个人财务分析系统</title>
    <style>
      body {
        margin: 0;
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
        background: #f7f9fc;
        color: #1f2937;
      }
      .container {
        max-width: 980px;
        margin: 28px auto;
        padding: 0 16px;
      }
      .card {
        background: #fff;
        border-radius: 12px;
        padding: 20px;
        box-shadow: 0 8px 20px rgba(15, 23, 42, 0.08);
        margin-bottom: 16px;
      }
      .topbar {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 12px;
        flex-wrap: wrap;
      }
      .nav a {
        color: #2563eb;
        text-decoration: none;
        margin-left: 8px;
      }
      .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr 1fr auto;
        gap: 10px;
      }
      input,
      select,
      button {
        padding: 10px 12px;
        border-radius: 8px;
        border: 1px solid #cbd5e1;
        font-size: 14px;
      }
      .btn {
        background: #2563eb;
        color: #fff;
        border: none;
        cursor: pointer;
      }
      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }
      th,
      td {
        text-align: left;
        border-bottom: 1px solid #e2e8f0;
        padding: 10px 8px;
      }
      .ok {
        color: #16a34a;
        font-weight: 600;
      }
      .warn {
        color: #d97706;
        font-weight: 600;
      }
      .danger {
        color: #dc2626;
        font-weight: 600;
      }
      .msg {
        margin-bottom: 8px;
        font-size: 14px;
      }
    </style>
  </head>
  <body>
    <main class="container">
      <section class="card topbar">
        <div>
          <h1>预算模块</h1>
          <div>当前月份：{{ month }}</div>
        </div>
        <div class="nav">
          <a href="/">首页</a>
          <a href="/analysis">分析</a>
          <a href="/ai">AI 复盘</a>
        </div>
      </section>

      <section class="card">
        {% if success == '1' %}
        <div class="msg ok">预算已保存。</div>
        {% elif success == '0' %}
        <div class="msg danger">保存失败：请填写有效预算金额。</div>
        {% endif %}

        <form method="post" action="/budget" class="form-grid">
          <input type="month" name="month" value="{{ month }}" required />
          <select name="category_main">
            <option value="">总预算（不选类别）</option>
            {% for category in category_options %}
            <option value="{{ category }}">{{ category }}</option>
            {% endfor %}
          </select>
          <input type="number" step="0.01" min="0.01" name="budget_amount" placeholder="预算金额" required />
          <button class="btn" type="submit">保存预算</button>
        </form>
      </section>

      <section class="card">
        <h2>预算执行情况</h2>
        <p>本月实际总支出：¥{{ '%.2f'|format(budget_data.total_expense) }}</p>

        {% if budget_data['items'] %}
        <table>
          <thead>
            <tr>
              <th>类别</th>
              <th>预算</th>
              <th>实际支出</th>
              <th>执行率</th>
              <th>状态</th>
            </tr>
          </thead>
          <tbody>
            {% for item in budget_data['items'] %}
            <tr>
              <td>{{ item.category_main if item.category_main else '总预算' }}</td>
              <td>¥{{ '%.2f'|format(item.budget_amount) }}</td>
              <td>¥{{ '%.2f'|format(item.actual_expense) }}</td>
              <td>{{ '%.2f'|format(item.execution_rate) }}%</td>
              <td>
                {% if item.status == '正常' %}
                <span class="ok">正常</span>
                {% elif item.status == '接近' %}
                <span class="warn">接近</span>
                {% else %}
                <span class="danger">超支</span>
                {% endif %}
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p>暂无预算记录，请先新增一条预算。</p>
        {% endif %}
      </section>
    </main>
  </body>
</html>
